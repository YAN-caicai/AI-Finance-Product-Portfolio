<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è´¢åŠ¡æŠ¥é”€åˆè§„åŠ©æ‰‹ Â· Demo</title>
  <style>
    :root {
      /* ä¼˜åŒ–åçš„é…è‰²æ–¹æ¡ˆ */
      --bg: #f9f9f9;
      --fg: #333333;
      --muted: #666666;
      --border: #e0e0e0;
      --radius-lg: 16px;
      --radius-md: 12px;
      --shadow-soft: 0 4px 12px rgba(0, 0, 0, 0.08);
      --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: var(--font-sans);
      letter-spacing: 0.03em;
      -webkit-font-smoothing: antialiased;
    }

    body {
      display: flex;
      justify-content: center;
      padding: 40px 16px 56px;
      opacity: 0;
      animation: fade-in 0.6s ease-out forwards;
    }

    @keyframes fade-in {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    main {
      width: 100%;
      max-width: 980px;
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      text-decoration: none;
      color: var(--muted);
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #ffffff;
      transition: background 0.18s ease, transform 0.12s ease,
        box-shadow 0.18s ease, color 0.18s ease, border-color 0.18s ease;
    }

    .back-link span.icon {
      font-size: 14px;
    }

    .back-link:hover {
      background: #f5f5f5;
      border-color: var(--muted);
      color: var(--fg);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-1px);
    }

    .demo-tag {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--muted);
    }

    .demo-shell {
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      background: #ffffff;
      box-shadow: var(--shadow-soft);
      padding: 24px;
    }

    .demo-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
    }

    .demo-title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .demo-title-main {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .demo-title-sub {
      font-size: 12px;
      color: var(--muted);
    }

    .chip {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #f5f5f5;
      color: var(--muted);
    }

    .chip-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #22c55e, #16a34a);
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.18);
    }

    .input-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 20px;
      align-items: stretch;
    }

    .input-shell {
      position: relative;
      flex: 1 1 260px;
      display: flex;
      align-items: center;
      background: #ffffff;
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 12px 16px 12px 40px;
      transition: border-color 0.18s ease, box-shadow 0.18s ease,
        background 0.18s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
    }

    .input-shell.focused {
      border-color: var(--muted);
      box-shadow: 0 0 0 2px rgba(102, 102, 102, 0.1);
    }

    .input-icon {
      position: absolute;
      left: 16px;
      font-size: 14px;
      color: var(--muted);
      pointer-events: none;
    }

    .input-shell input {
      border: none;
      outline: none;
      background: transparent;
      width: 100%;
      font-size: 14px;
      color: var(--fg);
    }

    .input-shell input::placeholder {
      color: #999999;
    }

    .btn-primary {
      flex: 0 0 auto;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 0 20px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
      border: none;
      cursor: pointer;
      background: #888888;
      color: #ffffff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: transform 0.12s ease, box-shadow 0.12s ease,
        background 0.18s ease;
      min-height: 44px;
      white-space: nowrap;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      background: #555555;
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      background: #444444;
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .btn-primary span.icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      font-size: 11px;
    }

    .scan-animation {
      position: relative;
      margin-bottom: 20px;
      height: 40px;
      overflow: hidden;
      border-radius: 8px;
      background: #f5f5f5;
      display: flex;
      align-items: center;
      padding: 0 16px;
      font-size: 13px;
      color: var(--muted);
      display: none;
    }

    .scan-line {
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
      animation: scan 1.5s ease-in-out infinite;
    }

    @keyframes scan {
      0% {
        left: -100%;
      }
      100% {
        left: 100%;
      }
    }

    .meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      font-size: 11px;
      color: var(--muted);
    }

    .meta-label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .meta-label-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--muted);
    }

    .confidence-tag {
      padding: 3px 10px;
      border-radius: 999px;
      background: rgba(22, 163, 74, 0.08);
      color: #15803d;
      border: 1px solid rgba(34, 197, 94, 0.28);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .confidence-tag span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #4ade80, #16a34a);
    }

    .compliance-score {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
    }

    .score-circle {
      position: relative;
      width: 80px;
      height: 80px;
    }

    .score-circle svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .score-circle-bg {
      fill: none;
      stroke: #f0f0f0;
      stroke-width: 8;
    }

    .score-circle-progress {
      fill: none;
      stroke: #22c55e;
      stroke-width: 8;
      stroke-linecap: round;
      stroke-dasharray: 220;
      stroke-dashoffset: 220;
      transition: stroke-dashoffset 0.5s ease;
    }

    .score-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 18px;
      font-weight: 600;
      color: var(--fg);
    }

    .score-label {
      font-size: 12px;
      color: var(--muted);
      text-align: center;
      margin-top: 4px;
    }

    .score-info {
      flex: 1;
    }

    .score-info h4 {
      margin: 0 0 8px 0;
      font-size: 14px;
      font-weight: 600;
      color: var(--fg);
    }

    .score-info p {
      margin: 0;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.5;
    }

    .audit-card {
      border-radius: var(--radius-lg);
      background: #ffffff;
      border: 1px solid var(--border);
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
      margin-bottom: 24px;
    }

    .audit-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .audit-title {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .audit-title-pill {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      background: #f5f5f5;
      color: var(--muted);
    }

    .audit-input-echo {
      font-size: 12px;
      color: var(--muted);
      border-radius: 8px;
      background: #f5f5f5;
      padding: 8px 12px;
      border: 1px dashed var(--border);
      display: none;
    }

    .audit-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin-top: 8px;
    }

    .pill {
      border-radius: var(--radius-md);
      padding: 12px;
      font-size: 12px;
      line-height: 1.5;
      display: flex;
      flex-direction: column;
      gap: 6px;
      background: #f5f5f5;
      animation: pill-fade-in 0.3s ease-out forwards;
      opacity: 0;
      transform: translateY(10px);
    }

    @keyframes pill-fade-in {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .pill:nth-child(1) {
      animation-delay: 0.1s;
    }

    .pill:nth-child(2) {
      animation-delay: 0.2s;
    }

    .pill:nth-child(3) {
      animation-delay: 0.3s;
    }

    .pill-label {
      font-weight: 500;
    }

    .pill-sub {
      font-size: 11px;
      opacity: 0.9;
    }

    .pill-success {
      background: #f0f9ff;
      color: #1e40af;
    }

    .pill-warning {
      background: #fff7ed;
      color: #9a3412;
    }

    .pill-error {
      background: #fef2f2;
      color: #991b1b;
    }

    .pill-muted {
      background: #f5f5f5;
      color: var(--muted);
    }

    .empty-hint {
      font-size: 12px;
      color: var(--muted);
      padding: 12px 0 4px;
    }

    .empty-hint span {
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco,
        Consolas, "Liberation Mono", "Courier New", monospace;
      background: rgba(0, 0, 0, 0.04);
      padding: 2px 4px;
      border-radius: 4px;
      font-size: 11px;
    }

    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .btn-secondary {
      flex: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
      border: 1px solid var(--border);
      cursor: pointer;
      background: #ffffff;
      color: var(--fg);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
      transition: transform 0.12s ease, box-shadow 0.12s ease,
        background 0.18s ease;
    }

    .btn-secondary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
      background: #f5f5f5;
    }

    .download-progress {
      margin-top: 16px;
      padding: 16px;
      background: #f5f5f5;
      border-radius: 8px;
      display: none;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 8px;
    }

    .progress-fill {
      height: 100%;
      background: #22c55e;
      border-radius: 4px;
      width: 0%;
      transition: width 0.3s ease;
    }

    .progress-text {
      font-size: 12px;
      color: var(--muted);
      text-align: center;
    }

    .demo-note {
      margin-top: 24px;
      font-size: 12px;
      color: var(--muted);
      text-align: center;
    }

    @media (max-width: 900px) {
      body {
        padding-top: 24px;
      }

      .demo-shell {
        padding: 20px;
        border-radius: 20px;
      }

      .input-row {
        flex-direction: column;
        align-items: stretch;
      }

      .btn-primary {
        width: 100%;
        justify-content: center;
      }

      .audit-grid {
        grid-template-columns: 1fr;
      }

      .compliance-score {
        flex-direction: column;
        align-items: flex-start;
      }

      .score-info {
        width: 100%;
      }

      .action-buttons {
        flex-direction: column;
      }
    }
  </style>
  </style>
</head>
<body>
  <main>
    <div class="top-bar">
      <a class="back-link" href="index.html">
        <span class="icon">â†</span>
        <span>è¿”å›ä¸»é¡µ</span>
      </a>
      <div class="demo-tag">Finance Â· Compliance Prototype</div>
    </div>

    <section class="demo-shell" aria-label="è´¢åŠ¡æŠ¥é”€åˆè§„åŠ©æ‰‹åŸå‹">
      <header class="demo-header">
        <div class="demo-title">
          <div class="demo-title-main">è´¢åŠ¡æŠ¥é”€åˆè§„åŠ©æ‰‹</div>
          <div class="demo-title-sub">ä¼ä¸šçº§åˆè§„å®¡è®¡ç³»ç»Ÿ</div>
        </div>
        <div class="chip">
          <span class="chip-dot"></span>
          <span>AI é©±åŠ¨</span>
        </div>
      </header>

      <section class="input-row">
        <div class="input-shell" id="input-shell">
          <span class="input-icon">ğŸ“</span>
          <input
            id="expense-input"
            type="text"
            placeholder="è¯·è¾“å…¥æŠ¥é”€å†…å®¹ï¼Œä¾‹å¦‚ï¼šé¤é¥® 300 å…ƒ"
            autocomplete="off"
          />
        </div>
        <button id="audit-button" class="btn-primary">
          <span class="icon">AI</span>
          <span id="btn-text">AI åˆè§„å®¡è®¡</span>
        </button>
      </section>

      <div class="scan-animation" id="scan-animation">
        <div class="scan-line"></div>
        <span>æ­£åœ¨å¯¹æ¥ä¼ä¸šåˆè§„åº“...</span>
      </div>

      <section class="meta-row">
        <div class="meta-label">
          <span class="meta-label-dot"></span>
          <span>ä¼ä¸šåˆè§„åº“ v2.1.0</span>
        </div>
        <div class="confidence-tag">
          <span class="dot"></span>
          <span>ç½®ä¿¡åº¦ 98%</span>
        </div>
      </section>

      <section class="compliance-score" id="compliance-score">
        <div class="score-circle">
          <svg viewBox="0 0 80 80">
            <circle class="score-circle-bg" cx="40" cy="40" r="35"></circle>
            <circle class="score-circle-progress" cx="40" cy="40" r="35"></circle>
          </svg>
          <div class="score-text" id="score-text">0</div>
          <div class="score-label">åˆè§„åˆ†æ•°</div>
        </div>
        <div class="score-info">
          <h4>åˆè§„è¯„ä¼°</h4>
          <p id="score-info">è¾“å…¥æŠ¥é”€å†…å®¹ï¼Œç³»ç»Ÿå°†è¿›è¡Œå¤šç»´åº¦åˆè§„æ£€æŸ¥å¹¶ç”Ÿæˆåˆ†æ•°</p>
        </div>
      </section>

      <section class="audit-card">
        <header class="audit-header">
          <div class="audit-title">
            å®¡è®¡ç»“æœ
            <span class="audit-title-pill">AI åˆ†æ</span>
          </div>
        </header>

        <div id="audit-input-echo" class="audit-input-echo"></div>

        <div id="audit-grid" class="audit-grid">
          <div class="pill pill-muted">
            <div class="pill-label">é€»è¾‘ A Â· åˆè§„æ€§æ£€æŸ¥</div>
            <div class="pill-sub">ç­‰å¾…è¾“å…¥ç¤ºä¾‹ï¼Œå¦‚â€œä¸Šæµ·å‡ºå·®æ™šé¤è´¹650å…ƒâ€</div>
          </div>
          <div class="pill pill-muted">
            <div class="pill-label">é€»è¾‘ B Â· å…³é”®è¦ç´ æ£€æŸ¥</div>
            <div class="pill-sub">åœ°ç‚¹ã€é‡‘é¢ã€äº‹ç”±ç­‰ç»´åº¦å°†è¢«æ‹†è§£é¢„è§ˆ</div>
          </div>
          <div class="pill pill-muted">
            <div class="pill-label">é€»è¾‘ C Â· ç­–ç•¥å»ºè®®</div>
            <div class="pill-sub">ç»“åˆ A/B ç»“æœç»™å‡º AI å»ºè®®è¯æœ¯</div>
          </div>
        </div>

        <div class="empty-hint">
          ç¤ºä¾‹ï¼šè¾“å…¥ <span>é¤é¥® 300 å…ƒ</span> æˆ– <span>è¥¿å®‰å‡ºå·® 500 å…ƒ</span> æŸ¥çœ‹å®¡è®¡ç»“æœ
        </div>
      </section>

      <div class="action-buttons">
        <button class="btn-secondary" id="pdf-btn">
          <span>ğŸ“„</span>
          <span>ç”Ÿæˆåˆè§„æŠ¥å‘Š PDF</span>
        </button>
      </div>

      <div class="download-progress" id="download-progress">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text">å‡†å¤‡ä¸‹è½½...</div>
      </div>

      <p class="demo-note">ğŸ“ æœ¬æ¼”ç¤ºåŸºäºä¼ä¸šè´¢åŠ¡åˆè§„æ ‡å‡†ï¼Œå®é™…åº”ç”¨éœ€æ ¹æ®ä¼ä¸šå…·ä½“æ”¿ç­–è°ƒæ•´</p>
    </section>
  </main>

  <script>
    (function () {
      const input = document.getElementById("expense-input");
      const button = document.getElementById("audit-button");
      const btnText = document.getElementById("btn-text");
      const grid = document.getElementById("audit-grid");
      const inputEcho = document.getElementById("audit-input-echo");
      const inputShell = document.getElementById("input-shell");
      const scanAnimation = document.getElementById("scan-animation");
      const scoreText = document.getElementById("score-text");
      const scoreInfo = document.getElementById("score-info");
      const scoreProgress = document.querySelector(".score-circle-progress");
      const pdfButton = document.getElementById("pdf-btn");
      const downloadProgress = document.getElementById("download-progress");
      const progressFill = document.getElementById("progress-fill");
      const progressText = document.getElementById("progress-text");

      if (!input || !button || !grid || !inputEcho || !inputShell) return;

      input.addEventListener("focus", () => {
        inputShell.classList.add("focused");
      });

      input.addEventListener("blur", () => {
        inputShell.classList.remove("focused");
      });

      function parseAmount(text) {
        if (!text) return null;
        const numMatches = text.match(/(\d+(?:\.\d+)?)/g);
        if (!numMatches || numMatches.length === 0) return null;
        const value = parseFloat(numMatches[numMatches.length - 1]);
        return isNaN(value) ? null : value;
      }

      function includesAny(text, keywords) {
        if (!text) return false;
        return keywords.some((k) => text.includes(k));
      }

      // è®¡ç®—åˆè§„åˆ†æ•°ï¼ˆç”Ÿæˆ80-95ä¹‹é—´çš„éšæœºåˆ†æ•°ï¼‰
      function calculateComplianceScore(analysis) {
        // ç”Ÿæˆ80-95ä¹‹é—´çš„éšæœºæ•´æ•°
        return Math.floor(Math.random() * 16) + 80;
      }

      // æ›´æ–°åˆè§„åˆ†æ•°ä»ªè¡¨ç›˜
      function updateScoreDashboard(score) {
        const circumference = 220;
        const offset = circumference - (score / 100) * circumference;
        scoreProgress.style.strokeDashoffset = offset;
        
        // å®ç°åˆ†æ•°ä»0åˆ°ç›®æ ‡å€¼çš„åŠ¨æ€æ»šåŠ¨æ•ˆæœ
        let currentScore = 0;
        const increment = score / 50; // 50æ­¥å®ŒæˆåŠ¨ç”»
        const timer = setInterval(() => {
          currentScore += increment;
          if (currentScore >= score) {
            currentScore = score;
            clearInterval(timer);
          }
          scoreText.textContent = Math.round(currentScore);
        }, 30);
        
        if (score >= 80) {
          scoreInfo.textContent = "åˆè§„æ€§è‰¯å¥½ï¼Œå»ºè®®æ­£å¸¸æäº¤æŠ¥é”€";
        } else if (score >= 60) {
          scoreInfo.textContent = "å­˜åœ¨éƒ¨åˆ†åˆè§„é—®é¢˜ï¼Œå»ºè®®è¡¥å……ç›¸å…³è¯´æ˜";
        } else {
          scoreInfo.textContent = "åˆè§„æ€§è¾ƒå·®ï¼Œå»ºè®®é‡æ–°æ•´ç†æŠ¥é”€å†…å®¹";
        }
      }

      function analyze(text) {
        const normalized = (text || "").trim();
        const amount = parseAmount(normalized);
        const hasMeal = includesAny(normalized, ["é¤é¥®", "æ™šé¤", "åˆé¤", "æ—©é¤", "èšé¤", "å·¥ä½œé¤", "é¤è´¹"]);
        const hasXiAn = normalized.includes("è¥¿å®‰");
        const hasLocation = includesAny(
          normalized,
          ["åŒ—äº¬", "ä¸Šæµ·", "å¹¿å·", "æ·±åœ³", "æ­å·", "å—äº¬", "æˆéƒ½", "æ­¦æ±‰", "è¥¿å®‰"]
        );

        const result = {
          logicA: {
            triggered: false,
            type: "success",
            label: "é€»è¾‘ A Â· é‡‘é¢åˆè§„æ€§",
            detail: "",
          },
          logicB: {
            triggered: false,
            type: "success",
            label: "é€»è¾‘ B Â· ç±»åˆ«ä¸åœ°ç‚¹",
            detail: "",
          },
          logicC: {
            type: "success",
            label: "é€»è¾‘ C Â· ç­–ç•¥å»ºè®®",
            detail: "",
          },
          meta: {
            amount,
            hasMeal,
            hasLocation,
            hasXiAn,
          },
        };

        // é€»è¾‘ Aï¼šé‡‘é¢ > 200 ä¸”åŒ…å«â€œé¤é¥®â€
        if (amount != null && amount > 200 && hasMeal) {
          result.logicA.triggered = true;
          result.logicA.type = "error";
          result.logicA.detail =
            "âš ï¸ æ£€æµ‹åˆ°é¤é¥®ç±»æŠ¥é”€é‡‘é¢è¶…è¿‡ 200 å…ƒï¼Œè¶…æ ‡é¢„è­¦ï¼Œå¯æ ¹æ®å†…éƒ¨å·®æ—…/é¤é¥®æ ‡å‡†è¿›ä¸€æ­¥æ ¸å¯¹ã€‚";
        } else if (!normalized) {
          result.logicA.type = "muted";
          result.logicA.detail = "ç­‰å¾…è¾“å…¥ç¤ºä¾‹ï¼Œå¦‚â€œè¥¿å®‰å‡ºå·®é¤é¥® 300 å…ƒâ€ã€‚";
        } else {
          result.logicA.type = "success";
          if (hasMeal && amount != null) {
            result.logicA.detail = "âœ… é¤é¥®æŠ¥é”€é‡‘é¢æœªè¶…è¿‡ 200 å…ƒï¼Œåˆæ­¥è§†ä¸ºåœ¨æ ‡å‡†èŒƒå›´å†…ã€‚";
          } else if (!hasMeal && amount != null) {
            result.logicA.detail = "âœ… å½“å‰è¯´æ˜æœªè¯†åˆ«ä¸ºé¤é¥®ç±»è´¹ç”¨ï¼Œä¸è§¦å‘è¯¥è§„åˆ™è¶…æ ‡æ£€æŸ¥ã€‚";
          } else {
            result.logicA.detail = "â„¹ï¸ æœªèƒ½ç¨³å®šè§£æé‡‘é¢æˆ–è´¹ç”¨ç±»å‹ï¼Œè¯¥è§„åˆ™æš‚ä¸è§¦å‘é¢„è­¦ã€‚";
          }
        }

        // é€»è¾‘ Bï¼šæ˜¯å¦åŒ…å«åœ°ç‚¹ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯è¥¿å®‰
        if (!normalized) {
          result.logicB.type = "muted";
          result.logicB.detail = "åœ°ç‚¹ã€é‡‘é¢ã€äº‹ç”±ç­‰ç»´åº¦å°†åœ¨è¾“å…¥åè‡ªåŠ¨æ‹†è§£é¢„è§ˆã€‚";
        } else if (hasXiAn) {
          result.logicB.type = "success";
          result.logicB.detail = "âœ… åŒ…å«è¥¿å®‰ï¼Œå·²åŒ¹é…å·®æ—…æ ‡å‡†ï¼Œå¯æ”¯æŒåç»­è¡Œç¨‹æ ¸å¯¹ä¸é¢„ç®—å½’é›†ã€‚";
        } else if (!result.meta.hasLocation) {
          result.logicB.triggered = true;
          result.logicB.type = "error";
          result.logicB.detail =
            "âŒ æœªè¯†åˆ«åˆ°åŸå¸‚ä¿¡æ¯ï¼ˆå¦‚åŒ—äº¬ã€ä¸Šæµ·ç­‰ï¼‰ï¼Œå»ºè®®è¡¥å……å‡ºå·®åŸå¸‚æˆ–å‘ç”Ÿåœ°ç‚¹ï¼Œä¾¿äºå·®æ—…ä¸é¢„ç®—æ ¸å¯¹ã€‚";
        } else {
          result.logicB.type = "success";
          result.logicB.detail = "âœ… å·²è¯†åˆ«åˆ°åŸå¸‚ä¿¡æ¯ï¼Œå¯æ”¯æŒåç»­è¡Œç¨‹æ ¸å¯¹ä¸é¢„ç®—å½’é›†ã€‚";
        }

        // é€»è¾‘ Cï¼šç­–ç•¥å»ºè®®ï¼Œæ ¹æ® A/B ç»„åˆ
        const issues = [];
        if (result.logicA.type === "error") issues.push("amountMeal");
        if (result.logicB.type === "error") issues.push("locationMissing");

        if (!normalized) {
          result.logicC.type = "muted";
          result.logicC.detail =
            "ç¤ºä¾‹ï¼šå¯å¼•å¯¼å‘˜å·¥æŒ‰ç…§â€œåŸå¸‚ + äº‹ç”± + é‡‘é¢â€ç»Ÿä¸€æ ¼å¼å¡«å†™ï¼Œä¾‹å¦‚â€œè¥¿å®‰å‡ºå·®Â·é¤é¥® 300 å…ƒâ€ã€‚";
        } else if (issues.length === 0) {
          result.logicC.type = "success";
          result.logicC.detail =
            "ä»å½“å‰è¯´æ˜çœ‹ï¼Œå…³é”®è¦ç´ ç›¸å¯¹å®Œæ•´ï¼Œä¸”æœªè§¦å‘æ˜æ˜¾è¶…æ ‡é£é™©ã€‚å»ºè®®åç»­ç»“åˆå‘ç¥¨æŠ¬å¤´ã€è¡Œç¨‹å•å’Œé¢„ç®—ç»´åº¦å†åšä¸€æ¬¡é›†ä¸­æŠ½æ ·å®¡è®¡ã€‚";
        } else if (issues.includes("amountMeal") && issues.includes("locationMissing")) {
          result.logicC.type = "error";
          result.logicC.detail =
            "å»ºè®®ï¼šâ‘  è¡¥å……å‡ºå·®åŸå¸‚æˆ–è´¹ç”¨å‘ç”Ÿåœ°ç‚¹ï¼›â‘¡ è¯·å‘˜å·¥ç¡®è®¤è¯¥é¤é¥®è´¹ç”¨æ˜¯å¦æŒ‰å…¬å¸é¤é¥®æ ‡å‡†æ‹†åˆ†æˆ–åˆå¹¶æŠ¥é”€ï¼›â‘¢ å¦‚ä¸ºå®¢æˆ·æ¥å¾…ï¼Œè¯·è¡¥å……æ¥å¾…å¯¹è±¡åŠåœºæ™¯è¯´æ˜ï¼Œä¾¿äºåç»­æŠ½æŸ¥ã€‚";
        } else if (issues.includes("amountMeal")) {
          result.logicC.type = "warning";
          result.logicC.detail =
            "å»ºè®®é‡ç‚¹å…³æ³¨è¯¥é¤é¥®è´¹ç”¨æ˜¯å¦åœ¨å…¬å¸å·®æ—…/é¤é¥®æ ‡å‡†èŒƒå›´å†…ï¼Œå¯åœ¨ç³»ç»Ÿä¸­å¢åŠ è‡ªåŠ¨å°é¡¶è§„åˆ™ï¼Œè¶…æ ‡éƒ¨åˆ†æç¤ºå‘˜å·¥è‡ªè¡Œæ‰¿æ‹…æˆ–èµ°å®¡æ‰¹åŠ ç­¾ã€‚";
        } else if (issues.includes("locationMissing")) {
          result.logicC.type = "warning";
          result.logicC.detail =
            "å»ºè®®åœ¨æŠ¥é”€å•æ¨¡æ¿ä¸­å°†â€œå‘ç”ŸåŸå¸‚/å‡ºå·®åŸå¸‚â€è®¾ä¸ºå¿…å¡«å­—æ®µï¼Œå‡å°‘åç»­è´¢åŠ¡è¡¥èµ„æ–™çš„æ²Ÿé€šæˆæœ¬ï¼Œå¹¶æ”¯æŒé¢„ç®—æŒ‰åŸå¸‚ç»´åº¦åšåˆ†æã€‚";
        }

        return result;
      }

      function createPill(type, label, detail) {
        const div = document.createElement("div");
        let cls = "pill ";
        switch (type) {
          case "success":
            cls += "pill-success";
            break;
          case "warning":
            cls += "pill-warning";
            break;
          case "error":
            cls += "pill-error";
            break;
          case "muted":
          default:
            cls += "pill-muted";
            break;
        }
        div.className = cls;

        const title = document.createElement("div");
        title.className = "pill-label";
        title.textContent = label;

        const sub = document.createElement("div");
        sub.className = "pill-sub";
        sub.textContent = detail;

        div.appendChild(title);
        div.appendChild(sub);
        return div;
      }

      function render(normalizedText, analysis) {
        while (grid.firstChild) {
          grid.removeChild(grid.firstChild);
        }

        if (!normalizedText) {
          inputEcho.style.display = "none";
        } else {
          inputEcho.style.display = "block";
          inputEcho.textContent = "è¾“å…¥ï¼š" + normalizedText;
        }

        const a = analysis.logicA;
        const b = analysis.logicB;
        const c = analysis.logicC;

        grid.appendChild(createPill(a.type, a.label, a.detail));
        grid.appendChild(createPill(b.type, b.label, b.detail));
        grid.appendChild(createPill(c.type, c.label, c.detail));
      }

      function handleAudit() {
        const raw = input.value || "";
        const normalized = raw.trim();

        if (!normalized) return;

        // æ˜¾ç¤ºæ‰«æåŠ¨ç”»
        scanAnimation.style.display = "flex";
        // æ›´æ”¹æŒ‰é’®çŠ¶æ€
        button.disabled = true;
        btnText.textContent = "å®¡è®¡ä¸­...";

        // æ¨¡æ‹Ÿ1.5ç§’çš„å®¡è®¡è¿‡ç¨‹
        setTimeout(() => {
          // éšè—æ‰«æåŠ¨ç”»
          scanAnimation.style.display = "none";
          // æ¢å¤æŒ‰é’®çŠ¶æ€
          button.disabled = false;
          btnText.textContent = "AI åˆè§„å®¡è®¡";

          const result = analyze(normalized);
          render(normalized, result);
          
          // è®¡ç®—å¹¶æ›´æ–°åˆè§„åˆ†æ•°
          const score = calculateComplianceScore(result);
          updateScoreDashboard(score);
        }, 1500);
      }

      // ç”ŸæˆPDFæŒ‰é’®ç‚¹å‡»äº‹ä»¶
      pdfButton.addEventListener("click", () => {
        // æ˜¾ç¤ºç®€å•çš„alertæç¤º
        alert("æŠ¥å‘Šç”Ÿæˆä¸­ï¼Œæ­£åœ¨å¯¼å‡º PDF...");
        
        // æ¨¡æ‹ŸPDFç”Ÿæˆè¿‡ç¨‹
        setTimeout(() => {
          alert("PDFæŠ¥å‘Šå·²ç”Ÿæˆå¹¶å¼€å§‹ä¸‹è½½ï¼");
        }, 1500);
      });

      button.addEventListener("click", handleAudit);
      input.addEventListener("keydown", (evt) => {
        if (evt.key === "Enter") {
          evt.preventDefault();
          handleAudit();
        }
      });
    })();
  </script>
</body>
</html>
